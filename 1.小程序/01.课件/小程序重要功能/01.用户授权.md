# 小程序用户授权

1. 截至到22/4/6,目前一共出现过3种获取用户个人信息的方法
2. 用户首次登陆授权方法
   1. 早期
      1. API:wx.getUserInfo(Object object)
      2. 在小程序早期的时候,只需要调用该API,就可以弹出授权窗口,获取用户个人信息
      3. 但是很多小程序开发者滥用该API,都在onLoad中调用该API找用户获取个人信息,导致不利于小程序推广,所以微信官方严格要求了该API的使用,只能在用户已经经过了首次授权流程之后才能使用
   2. 中期
      1. 该方案使用到21/4上旬才开始废弃
      2. 流程:
         1. 在页面上添加button组件
         2. 给button组件添加标签属性open-type,属性值为getUserInfo,就可以实现授权弹窗
         3. 给button组件绑定事件,事件名getuserinfo
         4. 从回调函数的形参中可以获取到用户相关信息
            1. 获取途径:res.detail.userInfo
         5. 将数据更新到data,最后在页面上实现渲染
      3. **注意:该方案如果想要练习,必须将小程序基础库版本切换到2.15.0以下**
   3. 最新
      1. **API:wx.getUserProfile(Object object)**
      2. **调用该API可以弹出授权窗口,获取用户的个人信息**
      3. **注意:**
         1. **该API的desc参数必须要填写,而且不能是数字**
         2. **该API只能在用户触发了tap事件的回调函数内部,才能够执行,某则无效**
         3. **该API每次调用都会弹出授权窗口**
            1. **该API如果想要实现二次登录免授权功能,就必须在第一次获取到用户信息的时候,将用户信息缓存起来,留作下次使用**
               1. **可能出现的问题:数据时效性不好(数据可能不是最新的)**
               2. **公司解决方案:在普通功能上使用缓存的用户信息,如果是重要功能就会重新获取一次用户信息**
         4. **该方案如果想要练习,必须将小程序基础库版本切换到2.15.0以上**
3. 用户二次登录免授权(又称为**静默登录**)
   1. 需求:当用户进入小程序的时候,自动获取用户信息,并且展示在页面上
   2. 拆解:
      1. 当用户进入小程序的时候
         1. 需要监视用户的进入小程序的操作,所以肯定要绑定监听来监视用户的操作
         2. 通过生命周期onLoad监视用户进入页面
      2. 自动获取用户信息
         1. 自动其实就是开发者使用js帮用户做事情
         2. 使用js的API来获取到用户信息
         3. **API:wx.getUserInfo(Object object)**
         4. **注意:该API其实如果用户没有经过首次登录授权流程,是无法使用的**
      3. 展示在页面上
         1. 只需要将数据更新到data中,页面就会自动渲染出最新的结果
4. 奇特的组件
   1. 组件名:open-data
   2. 该组件就是一个鸡肋,该组件只能看,不能用,用户可以看到自己的最新数据,但是开发人员无法获取到该标签展示的数据
   3. 该组件即将被废弃